
# Wurth Elektronix Oceanus Evaluation Kit - LoRaWAN Demo

A demonstration application for the Wurth Elektronix Oceanus Evaluation Kit using the STM32LoRaWAN library.

Copyright (c) 2025 FAB Controls Ltd - https://fabcontrols.co.uk

## Overview

This program demonstrates basic LoRaWAN functionality on the Oceanus-I EV Kit. It performs the following actions:
- Joins a LoRaWAN network using OTAA (Over-The-Air Activation).
- Periodically sends an uplink packet containing a static message.
- Prints the raw values of the three analog inputs to the serial monitor.
- Listens for downlink commands to control the two on-board LEDs and to reboot the device.

## Setup Instructions

To get this demo running, you will need to program the evaluation kit and register it on a LoRaWAN Network Server, such as The Things Network (TTN).

### 1. Program the Device

1.  Clone this repository.
2.  Open the project in PlatformIO.
3.  Build and upload the firmware to the Wurth Oceanus Evaluation Kit.
    > **Note**: Upload is via an ST-Link Programmer.
4. Uplink is also possible via J-LINK flash locate the complied code in .pio/build/we_oceanus1/firmware.elf
    > **Note**: Upload is not possible via serial at current.
 
### 2. Obtain Device Credentials

1.  After uploading, open the Serial Monitor in PlatformIO (or any other serial terminal) at **115200 baud**. You will need to discover the COM port generated by the USB-TTL converter.
    > **Note**: Ensure the jumpers are on PIN 1 and PIN 3 for the app UART over USB.
2.  The device will attempt to join the network. On startup, it will print a debug header containing the unique **Device EUI**.
3.  Copy the `Device EUI`. You will need it for the next step. See the example below of the debug header.

```javascript
  =====================================
    © FAB Controls Ltd - 2025
    Wurth Elektronix Oceanus Evaluation Kit
    LoRaWAN Status: Network Join failed
    Build Date: Current Date Here
    Device EUI: 0011223344556677
    ===================================== 
```
4.  The `App EUI` and `App Key` are defined in `src/secrets.h`. You will need to create this file by copying `src/secrets_change_me.h` to `src/secrets.h` and changing the the APP_EUI (optional) and APP_KEY (required) as defined in step 3 below.


### 3. Configure The Things Network (TTN)

1.  Log in to your TTN Console and go to your Applications.
2.  Create a new application if you don't have one already.
3.  Navigate to **End devices** and click **+ Add end device**.
4.  Select the **Manually** tab.
5.  Fill in the device details:
    *   **Frequency plan**: Select the appropriate plan. This firmware is configured for **Europe 863-870 MHz (SF92RX - recommended)**.
    *   **LoRaWAN version**: Select **LoRaWAN Specification 1.0.2**.
    *   **AppEUI**: Enter the `App EUI` from `src/secrets.h`.
    *   **DevEUI**: Enter the `Device EUI` you copied from the serial monitor.
    *   **AppKey**: Generate a new AppKey in the TTN console. Copy this key and paste it into the `SECRET_APP_KEY` definition in `src/secrets.h`.
6.  Click **Register end device**.
7.  **Re-build and upload the firmware** to the device with the correct `AppKey`.
8.  Reset the device using the onboard reset button. The device should now successfully join the network, and you will see "LoRaWAN Status: Network Joined" in the serial monitor, followed by uplink messages in the TTN console.

Example: 

```javascript
    =====================================
    © FAB Controls Ltd - 2025
    Wurth Elektronix Oceanus Evaluation Kit
    LoRaWAN Status: Network Joined
    Build Date: Current Date Here
    Device EUI: 0011223344556677
    ===================================== 
```

### 4. Configure Payload Formatter

In the TTN console for your device, navigate to the **Payload formatters** -> **Uplink** tab. Set the formatter type to **Custom Javascript formatter** and use the following decoder function to see the ASCII payload from the device:

```javascript
function Decoder(bytes, port) {
  // Convert an array of byte values into an ASCII string
  const asciiString = String.fromCharCode(...bytes);

  return {
    decodedString: asciiString
  };
}
```

### 5. Downlink Commands

You can send commands to the device via a downlink message from your LoRaWAN network server. The first byte of the payload determines the action.

| Command (Hex) | Action                  |
| :------------ | :---------------------- |
| `aa`          | Turn LED 1 ON, LED 2 OFF|
| `bb`          | Turn LED 1 OFF, LED 2 ON|
| `cc`          | Turn both LEDs ON       |
| `dd`          | Turn both LEDs OFF      |
| `ee`          | Reboot the device       |

To send a downlink from the TTN console:
1.  Go to your device's page.
2.  Find the **Messaging** section.
3.  Enter one of the hex commands in the **Payload** field.
4.  Set the **FPort** (e.g., to 1).
5.  Click **Schedule downlink**. The downlink will be queued and sent after the device's next uplink.

## Comments
1. Please file a merge or open an issue if you have a bug to report.
2. For LoRaWAN development assistance please see contact details on our website: 
  https://fabcontrols.co.uk

## License
     This project is licensed under the MIT License - see https://mit-license.org/ for details.